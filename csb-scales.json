{"isCustomSystemExport":true,"actors":[{"type":"_template","name":"_Scales","data":{"hidden":[{"name":"healthMalus","value":"${min(\n  (\n    10 == stun ? -2 : (\n      20 == stun ? -2 : (\n        60 == health ? -1 : (\n          70 == health ? -2 : 0\n        )\n      )\n    )\n  )\n)}$"},{"name":"stunStatus","value":"${switchCase(stun, \"0\", \"Tout va bien\", \"10\", \"Le personnage subit un malus de 2 points à toutes ses chances de réussite au cours du tour suivant et uniquement celui-ci.\", \"20\", \"Le personnage subit un malus de 2 points à toutes ses chances de réussite jusqu'à ce qu'il puisse récupérer en se reposant environ cinq minutes. \\nS'il est sonné une seconde fois avant de s'être reposé, il est considéré comme Assommé.\", \"30\", \"Le personnage s'évanouit pour (d10) minutes s’il est convenablement soigné. \\nSans aucune aide extérieure l'évanouissement sera cinq fois plus long.\")}$"},{"name":"healthStatus","value":"${switchCase(health, \"0\", \"Tout va bien\", \"50\", \"L'attaque n'a qu'un effet sanguinolent sans aucune conséquence grave. \\nLe sang coule, mais un bon pansement devrait pouvoir l'arrêter et éviter que la cicatrice ne soit trop visible.\", \"60\", \"Le personnage est meurtri dans sa chair mais sans que cela ait des conséquences vraiment fâcheuses. \\nLa douleur cause un malus de 1 point à toutes ses chances de réussite tant que la blessure n'est pas soignée (ce qui prend généralement quelques jours). \\nUne seconde blessure légère reçue moins d'une heure après la première cause une blessure grave (après une heure, la blessure reste légère).\", \"70\", \"Le personnage est blessé à un endroit grave. \\nLa douleur et la gêne causées par la blessure donnent un malus de 2 points à toutes ses chances de réussite tant que la blessure n'est pas soignée (ce qui prend généralement plusieurs semaines d'hôpital). \\nUne seconde blessure grave reçue moins d'une heure après la première cause un coma immédiat (après une heure, la blessure reste grave).\", \"80\", \"Le personnage est aux portes de la mort. \\nIl lutte de toutes ses forces pour rester en vie mais sombre néanmoins dans un profond coma. \\nIl ne pourra être réanimé qu'avec des moyens médicaux importants. \\nS'il n'est pas secouru avant une heure, il meurt sans jamais reprendre conscience. \\nUn second coma moins d'une heure après le premier cause la mort immédiate de la victime (après un heure, la blessure reste un coma).\", \"90\", \"Le personnage est mortellement touché. \\nIl peut à la rigueur s'en sortir avec des séquelles s'il est soigné rapidement (dans les 5 minutes) et s'il est ensuite suivi médicalement avec des appareils médicaux de haute technologie.\")}$"}],"header":{"contents":[{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"age","cssClass":"","role":"0","permission":"0","tooltip":"Age","visibilityFormula":"","label":"Age","defaultValue":"20","size":"full-size","allowDecimal":false,"minVal":"0","maxVal":"","allowRelative":false,"showControls":false,"controlsStyle":"hover","type":"numberField"},{"key":"gender","cssClass":"","role":"0","permission":"0","tooltip":"Genre","visibilityFormula":"","label":"Genre","defaultValue":"","size":"full-size","charList":"","maxLength":"","type":"textField"},{"key":"nationality","cssClass":"","role":"0","permission":"0","tooltip":"Nationalité","visibilityFormula":"","label":"Nationalité","defaultValue":"","size":"full-size","charList":"","maxLength":"","type":"textField"}],"flow":"grid-3","align":"justify","type":"panel"},{"key":"healthPanel","cssClass":"","role":"0","permission":"0","tooltip":"Etat de santé du personnage","visibilityFormula":"","contents":[{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"${stunStatus}$","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Moniteur étourdissement","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"${healthStatus}$","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Moniteur de santé","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label"},{"key":"stun","cssClass":"","role":"0","permission":"0","tooltip":"${stunStatus}$","visibilityFormula":"","label":"","defaultValue":"0","size":"full-size","options":[{"key":"0","value":"En bonne santé"},{"key":"10","value":"Légèrement sonné"},{"key":"20","value":"Sonné"},{"key":"30","value":"Assommé"}],"tableKey":null,"tableKeyColumn":null,"tableLabelColumn":null,"formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"},{"key":"health","cssClass":"","role":"0","permission":"0","tooltip":"${healthStatus}$","visibilityFormula":"","label":"","defaultValue":"0","size":"full-size","options":[{"key":"0","value":"En bonne santé"},{"key":"50","value":"Egratignure"},{"key":"60","value":"Blessure légère"},{"key":"70","value":"Blessure grave"},{"key":"80","value":"Coma"},{"key":"90","value":"Mort"}],"tableKey":null,"tableKeyColumn":null,"tableLabelColumn":null,"formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"}],"flow":"grid-2","align":"center","type":"panel"},{"key":"healthMalusPanel","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"healthMalusLabel","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Impact de l'état de santé :","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"bold","type":"label"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"<strong>${healthMalus}$</strong>","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label"}],"flow":"horizontal","align":"justify","type":"panel"}],"key":"custom_header","cssClass":null,"role":0,"permission":0,"tooltip":null,"visibilityFormula":null,"flow":null,"align":null,"type":"panel"},"body":{"contents":[{"key":"characterTabbedPanel","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"characterTab","cssClass":null,"role":"0","permission":"0","tooltip":"Description du personnage","visibilityFormula":"","contents":[{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"<strong>Description</strong>","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"subtitle","type":"label"},{"key":"description","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":null,"style":"dialog","type":"textArea"}],"flow":"vertical","align":"left","type":"panel"},{"key":"characteristics","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","rowLayout":[{"key":"name","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","charList":"","maxLength":"","type":"textField","align":"left","colName":"Caractéristiques"},{"key":"value","cssClass":"","role":"0","permission":"0","tooltip":"valeur de -8 à +8","visibilityFormula":"","label":"","defaultValue":"0","size":"small","allowDecimal":false,"minVal":"-8","maxVal":"+8","allowRelative":false,"showControls":false,"controlsStyle":"hover","type":"numberField","align":"right","colName":"Valeurs"}],"head":true,"deleteWarning":true,"predefinedLines":[],"canPlayerAdd":true,"type":"dynamicTable"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"carriers","cssClass":"","role":"0","permission":"0","tooltip":"Métiers","visibilityFormula":"","rowLayout":[{"key":"name","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","charList":"","maxLength":"","type":"textField","align":"left","colName":"Métiers"},{"key":"level","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"4","size":"full-size","options":[{"key":"4","value":"Débutant"},{"key":"2","value":"Qualifié"},{"key":"0","value":"Expert"}],"tableKey":null,"tableKeyColumn":null,"tableLabelColumn":null,"formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select","align":"left","colName":""},{"key":"characteristic","cssClass":"","role":"0","permission":"0","tooltip":"Choisir la caractéristique appropriée","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","options":[],"tableKey":"characteristics","tableKeyColumn":"value","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select","align":"left","colName":""},{"key":"roll","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"dice-d10","value":"","prefix":"","suffix":"","rollMessage":"<!-- Roll métier & hobby -->\n${#concat(\n  ?{diff:\"Difficulté\"|\"2\",\"Normal\"|\"0\",\"Facile\"|\"4\",\"Difficile\"},\n)}$\n\n${#sante:=healthMalus}$\n${#modificateur:= (sameRow('characteristic')?sameRow('characteristic') : 0)}$\n${#seuil:= 10 - sameRow('level') - diff}$        \n${#bonus:=((seuil + modificateur + sante) > 10 ? seuil + modificateur + sante - 10 : 0)}$\n\n<h3>Jet de <strong>${!sameRow('name')}$</strong> <span style=\"font-size: small;\">(${!(0 == diff ? \"Facile\" : (2 == diff ? \"Normal\":\"Difficile\"))}$)</span></h3>\n\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + bonus}$</strong> / ${seuil:= seuil + modificateur + sante}$\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; font-weight: bold; ${!roll<=seuil ? \"color: var(--color-level-success); border: solid 1px var(--color-level-success)\\\">Réussite\" : \"color: var(--color-level-error); border: solid 1px var(--color-level-error)\\\">Echec\"}$</p>\n      </td>\n    </tr>\n  </tbody>\n</table>","altRollMessage":"","style":"label","type":"label","align":"left","colName":""}],"head":true,"deleteWarning":true,"predefinedLines":[{"deleted":true},{"deleted":true}],"canPlayerAdd":true,"type":"dynamicTable"},{"key":"hobbies","cssClass":"","role":"0","permission":"0","tooltip":"Hobbies","visibilityFormula":"","rowLayout":[{"key":"name","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","charList":"","maxLength":"","type":"textField","align":"left","colName":"Hobbies"},{"key":"level","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"4","size":"full-size","options":[{"key":"4","value":"Amateur"},{"key":"2","value":"Normal"},{"key":"0","value":"Spécialiste"}],"tableKey":null,"tableKeyColumn":null,"tableLabelColumn":null,"formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select","align":"left","colName":""},{"key":"characteristic","cssClass":"","role":"0","permission":"0","tooltip":"Choisir la caractéristique appropriée","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","options":[],"tableKey":"characteristics","tableKeyColumn":"value","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select","align":"left","colName":""},{"key":"roll","cssClass":"","role":"0","permission":"0","tooltip":"Lancer les dés !","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"dice-d10","value":"","prefix":"","suffix":"","rollMessage":"<!-- Roll métier & hobby -->\n${#concat(\n  ?{diff:\"Difficulté\"|\"2\",\"Normal\"|\"0\",\"Facile\"|\"4\",\"Difficile\"},\n)}$\n\n${#modificateur:= (sameRow('characteristic')?sameRow('characteristic') : 0)}$\n${#seuil:= 10 - sameRow('level') - diff}$        \n${#bonus:=((seuil + modificateur) > 10 ? seuil + modificateur - 10 : 0)}$\n${#sante:=healthMalus}$\n\n<h3>Jet de <strong>${!sameRow('name')}$</strong> <span style=\"font-size: small;\">(${!(0 == diff ? \"Facile\" : (2 == diff ? \"Normal\":\"Difficile\"))}$)</span></h3>\n\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + bonus + sante}$</strong> / ${seuil:=seuil + modificateur}$\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; font-weight: bold; ${!roll<=seuil ? \"color: var(--color-level-success); border: solid 1px var(--color-level-success)\\\">Réussite\" : \"color: var(--color-level-error); border: solid 1px var(--color-level-error)\\\">Echec\"}$</p>\n      </td>\n    </tr>\n  </tbody>\n</table>","altRollMessage":"","style":"label","type":"label","align":"left","colName":""}],"head":true,"deleteWarning":true,"predefinedLines":[{"deleted":true}],"canPlayerAdd":true,"type":"dynamicTable"}],"flow":"grid-2","align":"left","type":"panel"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"unskilledCharacteristic","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"Caractéristique utilisée","defaultValue":"","size":"full-size","options":[],"tableKey":"characteristics","tableKeyColumn":"value","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"},{"key":"unskilledRoll","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"dice-d10","value":"Jet en tant que non qualifié","prefix":"","suffix":"","rollMessage":"<!-- Roll non qualifié -->\n${#concat(\n  ?{diff:\"Difficulté\"|2,\"Normal\"|0,\"Facile\"|4,\"Difficile\"},\n)}$\n\n${#sante:=healthMalus}$\n${#modificateur:= (unskilledCharacteristic ? unskilledCharacteristic : 0)}$\n${#seuil:= 10 - 6 - diff}$        \n${#bonus:=((seuil + modificateur + sante) > 10 ? seuil + modificateur + sante - 10 : 0)}$\n\n<h3>Jet <strong>Non qualifié</strong> <span style=\"font-size: small;\">(${!(0 == diff ? \"Facile\" : (2 == diff ? \"Normal\":\"Difficile\"))}$)</span></h3>\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + bonus}$</strong> / ${seuil:= seuil + modificateur + sante}$\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; font-weight: bold; ${!roll<=seuil ? \"color: var(--color-level-success); border: solid 1px var(--color-level-success)\\\">Réussite\" : \"color: var(--color-level-error); border: solid 1px var(--color-level-error)\\\">Echec\"}$</p>\n      </td>\n    </tr>\n  </tbody>\n</table>","altRollMessage":"","style":"label","type":"label"}],"flow":"grid-2","align":"left","type":"panel"}],"name":"Personnage","type":"tab"},{"key":"fightTab","cssClass":null,"role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"fightness","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"Combativité","defaultValue":"0","size":"medium","allowDecimal":false,"minVal":"-3","maxVal":"3","allowRelative":false,"showControls":false,"controlsStyle":"hover","type":"numberField"}],"flow":"horizontal","align":"center","type":"panel"},{"key":"weapons","cssClass":"","role":"0","permission":"0","tooltip":"Placer les armes ici","visibilityFormula":"","rowLayout":[{"key":"type","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"${switchCase(item.combatType, \"1\", \"Corps-à-corps\", \"2\", \"Contact\", \"3\", \"Distance\", \"<i>Non défini</i>\")}$","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label","align":"left","colName":"Type"},{"key":"powerfull","cssClass":"","role":"0","permission":"0","tooltip":"Puissance","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"${switchCase(item.powerfullMax, \"1\", \"Faible\", \"2\", \"Moyenne\", \"3\", \"Forte\", item.powerfullMax)}$","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label","align":"left","colName":"Puissance"},{"key":"attack","cssClass":"","role":"0","permission":"0","tooltip":"Faire un jet d'attaque","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"dice-d10","value":"","prefix":"","suffix":"","rollMessage":"<!-- Roll for attack -->\n${#concat(\n  ?{diff:\"Difficulté\"|\"2\",\"Normal\"|\"0\",\"Facile\"|\"4\",\"Difficile\"},\n)}$\n\n${#sante:=healthMalus}$\n${#combativite:=fightness}$\n${#type:=item.combatType}$\n\n<!-- définition des valeurs par défaut -->\n${#default:=6}$\n${#ccCombatCarrier:= (ccCombatCarrier ? ccCombatCarrier : default)}$\n${#ccCombatHobby:= (ccCombatHobby ? ccCombatHobby : default)}$\n${#contactCombatCarrier:= (contactCombatCarrier ? contactCombatCarrier : default)}$\n${#contactCombatHobby:= (contactCombatHobby ? contactCombatHobby : default)}$\n${#distanceCombatCarrier:= (distanceCombatCarrier ? distanceCombatCarrier : default)}$\n${#distanceCombatHobby:= (distanceCombatHobby ? distanceCombatHobby : default)}$\n\n<!-- définition du niveau du métier ou du hobby de référence -->\n${#level:=switchCase(type, \"1\", ${ccCombatCarrier >= ccCombatHobby ? ccCombatHobby : ccCombatCarrier}$, \"2\", ${contactCombatCarrier >= contactCombatHobby ? contactCombatHobby : contactCombatCarrier}$, \"3\", ${distanceCombatCarrier >= distanceCombatHobby ? distanceCombatHobby : distanceCombatCarrier}$, default)}$\n\n<!-- définition de la caractéristique de référence -->\n${#default:=0}$\n${#modificateur:=switchCase(type, \"1\", ${ccCombatCharacteristic?ccCombatCharacteristic:default}$, \"2\", ${contactCombatCharacteristic?contactCombatCharacteristic:default}$, \"3\", ${distanceCombatCharacteristic?distanceCombatCharacteristic:default}$, default)}$\n\n<!-- combativité de la cible -->\n${combativiteAdverse:=(3 == type ? fetchFromActor('target', 'fightness') : 0)}$\n\n<!-- calcul du seuil de réussite -->\n${#seuil:= 10 - level - diff}$\n\n<!-- calcul du bonus si le seuil est supérieur à 10 -->\n${#bonus:=((seuil + modificateur + combativite + combativiteAdverse + sante) > 10 ? seuil + modificateur + combativite + combativiteAdverse + sante - 10 : 0)}$\n\n<h3>Attaque avec <strong>${!item.name}$</strong> <span style=\"font-size: small;\">(${!(0 == diff ? \"Facile\" : (2 == diff ? \"Normal\":\"Difficile\"))}$)</span></h3>\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + bonus}$</strong> / ${seuil:=seuil + modificateur + combativite + combativiteAdverse + sante}$\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; font-weight: bold; ${!roll<=seuil ? \"color: var(--color-level-success); border: solid 1px var(--color-level-success)\\\">Réussite\" : \"color: var(--color-level-error); border: solid 1px var(--color-level-error)\\\">Echec\"}$</p>\n      </td>\n    </tr>\n  </tbody>\n</table>\n","altRollMessage":"","style":"label","type":"label","align":"center","colName":"Jet d'attaque"},{"key":"damage","cssClass":"","role":"0","permission":"0","tooltip":"Lancer les dommages","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"star-exclamation","value":"","prefix":"","suffix":"","rollMessage":"<!-- Jet pour calculer les dégâts des armes aux corps-à-corps, contact et distance -->\n${#concat(\n  ?{powerfull:\"Puissance\"|1,concat(\"Faible\",(1==item.powerfullMax?\" (max)\":\"\"))|2,concat(\"Moyenne\",(2==item.powerfullMax?\" (max)\":\"\"))|3,concat(\"Forte\",(3==item.powerfullMax?\" (max)\":\"\"))},\n  ?{modificateur:\"Modificateur de caractéristique\"[number]}\n)}$\n\n${#combativite:=fightness}$\n${#type:=item.combatType}$\n\n<!-- vérification qu'une cible a bien été sélectionnée -->\n${#(fetchFromActor(\"target\", \"name\")?\"\":notify(\"error\", \"Vous devez sélectionner une cible !\"))}$\n\n<!-- bonus de la caracteristique si combat corps-à-corps ou contact -->\n${#bonusForce:=(3 == type ? 0 : powerfullCharacteristic)}$\n\n<!-- malus de la résistance de la cible -->\n${#resistance:=fetchFromActor(\"target\", \"resistanceCharacteristic\", 0)}$\n\n<h3>Dégats de puissance ${!switchCase(powerfull, \"1\", \"Faible\",\"2\", \"Moyenne\",\"3\", \"Forte\", \"<i>non définie</i>\")}$ sur <strong>@{target|name}</strong> par @{selected|name}</h3>\n\n<!-- vérification de la puissance utilisée -->\n${!(powerfull > item.powerfullMax\n  ?\"<div style=\\\"padding: 2px; text-align: center; color: var(--color-level-warning); border: solid 1px var(--color-level-warning)\\\">La <strong>puissance choisie</strong> doit être <strong>inférieure ou</strong> égale à la <strong>puissance maximale</strong> de l'attaque</div>\"\n  :\"\"\n)}$\n\n<!--\ncode blessures :\n*  0 = Rien\n* 10 = Légèrement sonné\n* 20 = Sonné\n* 30 = Assommé\n* 40 = Dommage critique\n* 50 = Egratignure\n* 60 = Blessure légère\n* 70 = Blessure grave\n* 80 = Coma\n* 90 = Mort\n-->\n\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + combativite + modificateur + bonusForce - resistance}$</strong>\n      </td>\n    </tr>\n${#damage:=switchCase(type, \"1\", switchCase(powerfull, \"1\", (3 >= roll ? 0:(7 >= roll ? 10 : 20)), \"2\", (3 >= roll ? 10 : (7 >= roll ? 20 : 30)), \"3\", (3 >= roll ? 20 : (7 >= roll ? 30 : 40))), \"2\", switchCase(powerfull, \"1\", (3 >= roll ? 0:(7 >= roll ? 50 : 60)), \"2\", (3 >= roll ? 50 : (7 >= roll ? 60 : 70)), \"3\", (3 >= roll ? 60 : (7 >= roll ? 70 : 80))), \"3\", switchCase(powerfull, \"1\", (3 >= roll ? 0:(7 >= roll ? 60 : 70)), \"2\", (3 >= roll ? 60 : (7 >= roll ? 70 : 80)), \"3\", (3 >= roll ? 70 : (7 >= roll ? 80 : 90))))}$\n\n${#damageName:=switchCase(damage, 0, \"Rien\", 10, \"Légèrement sonné\", 20, \"Sonné\", 30, \"Assommé\", 40, \"Dommage critique\", 50, \"Egratignure\", 60, \"Blessure légère\", 70, \"Blessure grave\", 80, \"Coma\", 90, \"Mort\")}$\n\n${#damageDetail:=switchCase(damage, 0, \"Loupé !\", 10, \"Le personnage subit un <strong>malus de 2 points</strong> à toutes ses chances de réussite <strong>au cours du tour suivant</strong> et uniquement celui-ci.\", 20, \"Le personnage subit <strong>un malus de 2 points</strong> à toutes ses chances de réussite jusqu'à ce qu'il puisse récupérer en se reposant environ cinq minutes. <br/>S'il est sonné une seconde fois avant de s'être reposé, il est considéré comme Assommé.\", 30, \"Le personnage s'évanouit <strong>pour ${[1d10]}$ minutes</strong> s'il est convenablement soigné.</strong> <br/>Sans aucune aide extérieure l'évanouissement sera <strong>cinq fois plus long</strong>.\", 40, \"Le personnage est <strong>Assommé</strong>  pour <strong>${[1d10]}$ minutes</strong> et subit une <strong>Blessure Légère</strong>.\", 50, \"L'attaque n'a qu'un effet sanguinolent sans aucune conséquence grave. Le sang coule, mais un bon pansement devrait pouvoir l'arrêter et éviter que la cicatrice ne soit trop visible.\", 60, \"Le personnage est meurtri dans sa chair mais sans que cela ait des conséquences vraiment fâcheuses. La douleur cause un <strong>malus de 1 point</strong> à toutes ses chances de réussite tant que la blessure n'est pas soignée (ce qui prend généralement quelques jours). <br/>Une seconde blessure légère reçue moins d'une heure après la première cause une blessure grave (après une heure, la blessure reste légère).\", 70, \"Le personnage est blessé à un endroit grave. La douleur et la gêne causées par la blessure donnent un <strong>malus de 2 points</strong> à toutes ses chances de réussite tant que la blessure n'est pas soignée (ce qui prend généralement plusieurs semaines d'hôpital).<br/>Une seconde blessure grave reçue moins d'une heure après la première cause un coma immédiat (après une heure, la blessure reste grave).\", 80, \"Le personnage est aux portes de la mort. Il lutte de toutes ses forces pour rester en vie mais sombre néanmoins dans un profond coma. Il ne pourra être réanimé qu'avec des moyens médicaux importants. <strong>S'il n'est pas secouru avant une heure, il meurt sans jamais reprendre conscience</strong>.<br/>Un second coma moins d'une heure après le premier cause la mort immédiate de la victime (après un heure, la blessure reste un coma).\", 90, \"Le personnage est mortellement touché. Il peut à la rigueur s'en sortir avec des séquelles s'il est soigné rapidement (dans les 5 minutes) et s'il est ensuite suivi médicalement avec des appareils médicaux de haute technologie.\")}$    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; border: solid 1px var(--color-border-dark)\">\n          <strong>${!damageName}$</strong>\n        </p>\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: justify; border: solid 1px var(--color-border-dark)\">\n          ${!damageDetail}$\n        </p>\n      </td>\n    </tr>\n  </tbody>\n</table>","altRollMessage":"","style":"label","type":"label","align":"center","colName":"Dégats"}],"head":true,"deleteWarning":true,"title":"<strong>Armes</strong>","hideEmpty":false,"headDisplay":true,"showDelete":true,"statusIcon":false,"nameAlign":"left","nameLabel":"Nom","templateFilter":["Yeod9gkpDUu7RJQB"],"itemFilter":[],"type":"itemContainer"},{"key":"carriersHobbiesPanel","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Corps-à-corps","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"bold","type":"label"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Contact","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"bold","type":"label"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Distance","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"bold","type":"label"},{"key":"","cssClass":"preferred-panel","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Métier préféré","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label"},{"key":"ccCombatCarrier","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","options":[],"tableKey":"carriers","tableKeyColumn":"level","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Hobby préféré","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label"},{"key":"ccCombatHobby","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","options":[],"tableKey":"hobbies","tableKeyColumn":"level","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Caractéristique préférée","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label"},{"key":"ccCombatCharacteristic","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","options":[],"tableKey":"characteristics","tableKeyColumn":"value","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"}],"flow":"grid-2","align":"left","type":"panel"},{"key":"","cssClass":"preferred-panel","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Métier préféré","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label"},{"key":"contactCombatCarrier","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","options":[],"tableKey":"carriers","tableKeyColumn":"level","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Hobby préféré","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label"},{"key":"contactCombatHobby","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","options":[],"tableKey":"hobbies","tableKeyColumn":"level","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Caractéristique préférée","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label"},{"key":"contactCombatCharacteristic","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","options":[],"tableKey":"characteristics","tableKeyColumn":"value","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"}],"flow":"grid-2","align":"left","type":"panel"},{"key":"","cssClass":"preferred-panel","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Métier préféré","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label"},{"key":"distanceCombatCarrier","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","options":[],"tableKey":"carriers","tableKeyColumn":"level","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Hobby préféré","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label"},{"key":"distanceCombatHobby","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","options":[],"tableKey":"hobbies","tableKeyColumn":"level","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Caractéristique préférée","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"label","type":"label"},{"key":"distanceCombatCharacteristic","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":"full-size","options":[],"tableKey":"characteristics","tableKeyColumn":"value","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"}],"flow":"grid-2","align":"left","type":"panel"}],"flow":"grid-3","align":"left","type":"panel"},{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"powerfullCharacteristic","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"Pour la puissance des attaques (corps-à-corps et contact)","defaultValue":"","size":"full-size","options":[],"tableKey":"characteristics","tableKeyColumn":"value","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"},{"key":"resistanceCharacteristic","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"Pour la résistance face aux attaques (corps-à-corps et contact)","defaultValue":"","size":"full-size","options":[],"tableKey":"characteristics","tableKeyColumn":"value","tableLabelColumn":"name","formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"}],"flow":"horizontal","align":"center","type":"panel"}],"name":"Combat","type":"tab"},{"key":"biographyTab","cssClass":null,"role":"0","permission":"0","tooltip":"Tout savoir de la vie du personnage","visibilityFormula":"","contents":[{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Expérience","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"subtitle","type":"label"},{"key":"xp","cssClass":"","role":"0","permission":"0","tooltip":"Expérience du personnage","visibilityFormula":"","label":"","defaultValue":"0","size":"medium","allowDecimal":false,"minVal":"0","maxVal":"","allowRelative":true,"showControls":false,"controlsStyle":"hover","type":"numberField"}],"flow":"grid-2","align":"center","type":"panel"},{"key":"panel","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"biographyPanel","cssClass":null,"role":"0","permission":"0","tooltip":"Biographie","visibilityFormula":"","contents":[{"key":"biography","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":"","defaultValue":"","size":null,"style":"sheet","type":"textArea"}],"name":"Biographie","type":"tab"},{"key":"privateBiographyPanel","cssClass":null,"role":"0","permission":"3","tooltip":"","visibilityFormula":"","contents":[{"key":"privateBiography","cssClass":"","role":"0","permission":"0","tooltip":"Biographie privée","visibilityFormula":"","label":"","defaultValue":"","size":null,"style":"sheet","type":"textArea"}],"name":"Biographie privée","type":"tab"}],"type":"tabbedPanel"}],"name":"Biographie","type":"tab"}],"type":"tabbedPanel"}],"key":"custom_body","cssClass":null,"role":0,"permission":0,"tooltip":null,"visibilityFormula":null,"flow":null,"align":null,"type":"panel"},"display":{"width":"775","height":"600","fix_size":false,"pp_width":"128","pp_height":"128"},"attributeBar":{},"activeEffects":{},"activeConditionalModifierGroups":[],"templateSystemUniqueVersion":2725381201},"flags":{"custom-system-builder":{"version":"3.0.0","templateHistory":[[{"kind":"E","path":["body","contents",0,"contents",1,"contents",1,"rowLayout",4,"rollMessage"],"lhs":"${nameTarget:= fetchFromActor(\"target\", \"name\")}$\n<br/>\n${stunTarget:= fetchFromActor(\"target\", \"stun\")}$\n<br/>\n${healthTarget:= fetchFromActor(\"target\", \"health\")}$\n<br/>\n${#assomme:=30}$\n${#blessureLegere:=60}$\n${concat(string(setPropertyInEntity('target', 'stun', 'assomme')), string(setPropertyInEntity('target', 'health', 'blessureLegere')))}$","rhs":"${nameTarget:= fetchFromActor(\"target\", \"name\")}$\n<br/>\n${stunTarget:= fetchFromActor(\"target\", \"stun\")}$\n<br/>\n${healthTarget:= fetchFromActor(\"target\", \"health\")}$\n<br/>\n${#assomme:=30}$\n${#blessureLegere:=60}$\n${concat(string(setPropertyInEntity('target', 'stun.key', 'assomme')), string(setPropertyInEntity('target', 'health.key', 'blessureLegere')))}$"}],[{"kind":"E","path":["body","contents",0,"contents",1,"contents",1,"rowLayout",4,"rollMessage"],"lhs":"${nameTarget:= fetchFromActor(\"target\", \"name\")}$\n<br/>\n${stunTarget:= fetchFromActor(\"target\", \"stun\")}$\n<br/>\n${healthTarget:= fetchFromActor(\"target\", \"health\")}$\n<br/>\n${#assomme:=30}$\n${#blessureLegere:=60}$\n${concat(string(setPropertyInEntity('target', 'stun.key', 'assomme')), string(setPropertyInEntity('target', 'health.key', 'blessureLegere')))}$","rhs":"setPropertyInEntity('target', 'stun', 30)"}],[{"kind":"E","path":["body","contents",0,"contents",1,"contents",1,"rowLayout",4,"rollMessage"],"lhs":"setPropertyInEntity('target', 'stun', 30)","rhs":"${setPropertyInEntity('target', 'stun', 30)}$"}],[{"kind":"E","path":["body","contents",0,"contents",1,"contents",1,"rowLayout",4,"rollMessage"],"lhs":"${setPropertyInEntity('target', 'stun', 30)}$","rhs":"${setPropertyInEntity('target', 'ref(stun)', 30)}$"}],[{"kind":"E","path":["body","contents",0,"contents",1,"contents",1,"rowLayout",3,"rollMessage"],"lhs":"<!-- Jet pour calculer les dégâts des armes aux corps-à-corps, contact et distance -->\n${#concat(\n  ?{powerfull:\"Puissance\"|1,concat(\"Faible\",(1==item.powerfullMax?\" (max)\":\"\"))|2,concat(\"Moyenne\",(2==item.powerfullMax?\" (max)\":\"\"))|3,concat(\"Forte\",(3==item.powerfullMax?\" (max)\":\"\"))},\n  ?{modificateur:\"Modificateur de caractéristique\"[number]}\n)}$\n\n${#combativite:=fightness}$\n${#type:=item.combatType}$\n\n<!-- vérification qu'une cible a bien été sélectionnée -->\n${#(fetchFromActor(\"target\", \"name\")?\"\":notify(\"error\", \"Vous devez sélectionner une cible !\"))}$\n\n<!-- bonus de la caracteristique si combat corps-à-corps ou contact -->\n${#bonusForce:=(3 == type ? 0 : powerfullCharacteristic)}$\n\n<!-- malus de la résistance de la cible -->\n${#resistance:=fetchFromActor(\"target\", \"resistanceCharacteristic\", 0)}$\n\n<h3>Dégats de puissance ${!switchCase(powerfull, \"1\", \"Faible\",\"2\", \"Moyenne\",\"3\", \"Forte\", \"<i>non définie</i>\")}$ sur <strong>@{target|name}</strong> par @{selected|name}</h3>\n\n<!-- vérification de la puissance utilisée -->\n${!(powerfull > item.powerfullMax\n  ?\"<div style=\\\"padding: 2px; text-align: center; color: var(--color-level-warning); border: solid 1px var(--color-level-warning)\\\">La <strong>puissance choisie</strong> doit être <strong>inférieure ou</strong> égale à la <strong>puissance maximale</strong> de l'attaque</div>\"\n  :\"\"\n)}$\n\n<!--\ncode blessures :\n*  0 = Rien\n* 10 = Légèrement sonné\n* 20 = Sonné\n* 30 = Assommé\n* 40 = Dommage critique\n* 50 = Egratignure\n* 60 = Blessure légère\n* 70 = Blessure grave\n* 80 = Coma\n* 90 = Mort\n-->\n\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + combativite + modificateur + bonusForce - resistance}$</strong>\n      </td>\n    </tr>\n${#damage:=switchCase(type, \"1\", switchCase(powerfull, \"1\", (3 >= roll ? 0:(7 >= roll ? 10 : 20)), \"2\", (3 >= roll ? 10 : (7 >= roll ? 20 : 30)), \"3\", (3 >= roll ? 20 : (7 >= roll ? 30 : 40))), \"2\", switchCase(powerfull, \"1\", (3 >= roll ? 0:(7 >= roll ? 50 : 60)), \"2\", (3 >= roll ? 50 : (7 >= roll ? 60 : 70)), \"3\", (3 >= roll ? 60 : (7 >= roll ? 70 : 80))), \"3\", switchCase(powerfull, \"1\", (3 >= roll ? 0:(7 >= roll ? 60 : 70)), \"2\", (3 >= roll ? 60 : (7 >= roll ? 70 : 80)), \"3\", (3 >= roll ? 70 : (7 >= roll ? 80 : 90))))}$\n\n${#damageName:=switchCase(damage, 0, \"Rien\", 10, \"Légèrement sonné\", 20, \"Sonné\", 30, \"Assommé\", 40, \"Dommage critique\", 50, \"Egratignure\", 60, \"Blessure légère\", 70, \"Blessure grave\", 80, \"Coma\", 90, \"Mort\")}$\n\n${#damageDetail:=switchCase(damage, 0, \"Loupé !\", 10, \"Le personnage subit un <strong>malus de 2 points</strong> à toutes ses chances de réussite <strong>au cours du tour suivant</strong> et uniquement celui-ci.\", 20, \"Le personnage subit <strong>un malus de 2 points</strong> à toutes ses chances de réussite jusqu'à ce qu'il puisse récupérer en se reposant environ cinq minutes. <br/>S'il est sonné une seconde fois avant de s'être reposé, il est considéré comme Assommé.\", 30, \"Le personnage s'évanouit <strong>pour ${[1d10]}$ minutes</strong> s'il est convenablement soigné.</strong> <br/>Sans aucune aide extérieure l'évanouissement sera <strong>cinq fois plus long</strong>.\", 40, \"Le personnage est <strong>Assommé</strong>  pour <strong>${[1d10]}$ minutes</strong> et subit une <strong>Blessure Légère</strong>.\", 50, \"L'attaque n'a qu'un effet sanguinolent sans aucune conséquence grave. Le sang coule, mais un bon pansement devrait pouvoir l'arrêter et éviter que la cicatrice ne soit trop visible.\", 60, \"Le personnage est meurtri dans sa chair mais sans que cela ait des conséquences vraiment fâcheuses. La douleur cause un <strong>malus de 1 point</strong> à toutes ses chances de réussite tant que la blessure n'est pas soignée (ce qui prend généralement quelques jours). <br/>Une seconde blessure légère reçue moins d'une heure après la première cause une blessure grave (après une heure, la blessure reste légère).\", 70, \"Le personnage est blessé à un endroit grave. La douleur et la gêne causées par la blessure donnent un <strong>malus de 2 points</strong> à toutes ses chances de réussite tant que la blessure n'est pas soignée (ce qui prend généralement plusieurs semaines d'hôpital).<br/>Une seconde blessure grave reçue moins d'une heure après la première cause un coma immédiat (après une heure, la blessure reste grave).\", 80, \"Le personnage est aux portes de la mort. Il lutte de toutes ses forces pour rester en vie mais sombre néanmoins dans un profond coma. Il ne pourra être réanimé qu'avec des moyens médicaux importants. <strong>S'il n'est pas secouru avant une heure, il meurt sans jamais reprendre conscience</strong>.<br/>Un second coma moins d'une heure après le premier cause la mort immédiate de la victime (après un heure, la blessure reste un coma).\", 90, \"Le personnage est mortellement touché. Il peut à la rigueur s'en sortir avec des séquelles s'il est soigné rapidement (dans les 5 minutes) et s'il est ensuite suivi médicalement avec des appareils médicaux de haute technologie.\")}$    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; border: solid 1px var(--color-border-dark)\">\n          <strong>${!damageName}$</strong>\n        </p>\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: justify; border: solid 1px var(--color-border-dark)\">\n          ${!damageDetail}$\n        </p>\n      </td>\n    </tr>\n  </tbody>\n</table>\n\n<!-- application des dégâts à la cible \nIF (dommage >= 50 AND dommage >= target.health) THEN\n  AppliquerDommageHealth()\nELSE\n  IF (dommage == 40 AND 60 > target.health) THEN\n    AppliquerDommageCritique()\n  ELSE\n    IF (30 >= dommage AND dommage >= target.stun) THEN\n      AppliquerDommageStun()\n    ELSE\n      // ne rien faire\n    FI\n  FI\nFI\n-->\n${nameTarget:= fetchFromActor(\"target\", \"name\")}$\n<br/>\n${stunTarget:= fetchFromActor(\"target\", \"stun\")}$\n<br/>\n${healthTarget:= fetchFromActor(\"target\", \"health\")}$\n<br/>\n${#assomme:=30}$\n${#blessureLegere:=60}$\n${(\n  damage >= 50 \n  ? (\n      damage > healthTarget\n      ? ${setPropertyInEntity('target', 'health', 'damage')}$\n      : \"pas de changement (1)\"\n    )\n  : (\n      40 == damage \n      ? (\n          60 > healthTarget \n          ? ${concat(string(setPropertyInEntity('target', 'stun', 'assomme')), string(setPropertyInEntity('target', 'health', 'blessureLegere')))}$\n          : \"pas de changement (2)\"\n        )\n      : (\n          30 >= damage\n          ? (\n              damage > stunTarget\n              ? ${setPropertyInEntity('target', 'stun', 'damage')}$\n              : \"pas de changement (3)\"\n            )\n          : \"pas de changement (4)\"\n        )\n    )\n)}$\n\n${nameTarget:= fetchFromActor(\"target\", \"name\")}$\n<br/>\n${stunTarget:= fetchFromActor(\"target\", \"stun\")}$\n<br/>\n${healthTarget:= fetchFromActor(\"target\", \"health\")}$","rhs":"<!-- Jet pour calculer les dégâts des armes aux corps-à-corps, contact et distance -->\n${#concat(\n  ?{powerfull:\"Puissance\"|1,concat(\"Faible\",(1==item.powerfullMax?\" (max)\":\"\"))|2,concat(\"Moyenne\",(2==item.powerfullMax?\" (max)\":\"\"))|3,concat(\"Forte\",(3==item.powerfullMax?\" (max)\":\"\"))},\n  ?{modificateur:\"Modificateur de caractéristique\"[number]}\n)}$\n\n${#combativite:=fightness}$\n${#type:=item.combatType}$\n\n<!-- vérification qu'une cible a bien été sélectionnée -->\n${#(fetchFromActor(\"target\", \"name\")?\"\":notify(\"error\", \"Vous devez sélectionner une cible !\"))}$\n\n<!-- bonus de la caracteristique si combat corps-à-corps ou contact -->\n${#bonusForce:=(3 == type ? 0 : powerfullCharacteristic)}$\n\n<!-- malus de la résistance de la cible -->\n${#resistance:=fetchFromActor(\"target\", \"resistanceCharacteristic\", 0)}$\n\n<h3>Dégats de puissance ${!switchCase(powerfull, \"1\", \"Faible\",\"2\", \"Moyenne\",\"3\", \"Forte\", \"<i>non définie</i>\")}$ sur <strong>@{target|name}</strong> par @{selected|name}</h3>\n\n<!-- vérification de la puissance utilisée -->\n${!(powerfull > item.powerfullMax\n  ?\"<div style=\\\"padding: 2px; text-align: center; color: var(--color-level-warning); border: solid 1px var(--color-level-warning)\\\">La <strong>puissance choisie</strong> doit être <strong>inférieure ou</strong> égale à la <strong>puissance maximale</strong> de l'attaque</div>\"\n  :\"\"\n)}$\n\n<!--\ncode blessures :\n*  0 = Rien\n* 10 = Légèrement sonné\n* 20 = Sonné\n* 30 = Assommé\n* 40 = Dommage critique\n* 50 = Egratignure\n* 60 = Blessure légère\n* 70 = Blessure grave\n* 80 = Coma\n* 90 = Mort\n-->\n\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + combativite + modificateur + bonusForce - resistance}$</strong>\n      </td>\n    </tr>\n${#damage:=switchCase(type, \"1\", switchCase(powerfull, \"1\", (3 >= roll ? 0:(7 >= roll ? 10 : 20)), \"2\", (3 >= roll ? 10 : (7 >= roll ? 20 : 30)), \"3\", (3 >= roll ? 20 : (7 >= roll ? 30 : 40))), \"2\", switchCase(powerfull, \"1\", (3 >= roll ? 0:(7 >= roll ? 50 : 60)), \"2\", (3 >= roll ? 50 : (7 >= roll ? 60 : 70)), \"3\", (3 >= roll ? 60 : (7 >= roll ? 70 : 80))), \"3\", switchCase(powerfull, \"1\", (3 >= roll ? 0:(7 >= roll ? 60 : 70)), \"2\", (3 >= roll ? 60 : (7 >= roll ? 70 : 80)), \"3\", (3 >= roll ? 70 : (7 >= roll ? 80 : 90))))}$\n\n${#damageName:=switchCase(damage, 0, \"Rien\", 10, \"Légèrement sonné\", 20, \"Sonné\", 30, \"Assommé\", 40, \"Dommage critique\", 50, \"Egratignure\", 60, \"Blessure légère\", 70, \"Blessure grave\", 80, \"Coma\", 90, \"Mort\")}$\n\n${#damageDetail:=switchCase(damage, 0, \"Loupé !\", 10, \"Le personnage subit un <strong>malus de 2 points</strong> à toutes ses chances de réussite <strong>au cours du tour suivant</strong> et uniquement celui-ci.\", 20, \"Le personnage subit <strong>un malus de 2 points</strong> à toutes ses chances de réussite jusqu'à ce qu'il puisse récupérer en se reposant environ cinq minutes. <br/>S'il est sonné une seconde fois avant de s'être reposé, il est considéré comme Assommé.\", 30, \"Le personnage s'évanouit <strong>pour ${[1d10]}$ minutes</strong> s'il est convenablement soigné.</strong> <br/>Sans aucune aide extérieure l'évanouissement sera <strong>cinq fois plus long</strong>.\", 40, \"Le personnage est <strong>Assommé</strong>  pour <strong>${[1d10]}$ minutes</strong> et subit une <strong>Blessure Légère</strong>.\", 50, \"L'attaque n'a qu'un effet sanguinolent sans aucune conséquence grave. Le sang coule, mais un bon pansement devrait pouvoir l'arrêter et éviter que la cicatrice ne soit trop visible.\", 60, \"Le personnage est meurtri dans sa chair mais sans que cela ait des conséquences vraiment fâcheuses. La douleur cause un <strong>malus de 1 point</strong> à toutes ses chances de réussite tant que la blessure n'est pas soignée (ce qui prend généralement quelques jours). <br/>Une seconde blessure légère reçue moins d'une heure après la première cause une blessure grave (après une heure, la blessure reste légère).\", 70, \"Le personnage est blessé à un endroit grave. La douleur et la gêne causées par la blessure donnent un <strong>malus de 2 points</strong> à toutes ses chances de réussite tant que la blessure n'est pas soignée (ce qui prend généralement plusieurs semaines d'hôpital).<br/>Une seconde blessure grave reçue moins d'une heure après la première cause un coma immédiat (après une heure, la blessure reste grave).\", 80, \"Le personnage est aux portes de la mort. Il lutte de toutes ses forces pour rester en vie mais sombre néanmoins dans un profond coma. Il ne pourra être réanimé qu'avec des moyens médicaux importants. <strong>S'il n'est pas secouru avant une heure, il meurt sans jamais reprendre conscience</strong>.<br/>Un second coma moins d'une heure après le premier cause la mort immédiate de la victime (après un heure, la blessure reste un coma).\", 90, \"Le personnage est mortellement touché. Il peut à la rigueur s'en sortir avec des séquelles s'il est soigné rapidement (dans les 5 minutes) et s'il est ensuite suivi médicalement avec des appareils médicaux de haute technologie.\")}$    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; border: solid 1px var(--color-border-dark)\">\n          <strong>${!damageName}$</strong>\n        </p>\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: justify; border: solid 1px var(--color-border-dark)\">\n          ${!damageDetail}$\n        </p>\n      </td>\n    </tr>\n  </tbody>\n</table>"}],[{"kind":"E","path":["body","contents",0,"contents",1,"contents",1,"rowLayout",2,"rollMessage"],"lhs":"<!-- Roll for attack -->\n${#concat(\n  ?{diff:\"Difficulté\"|\"2\",\"Normal\"|\"0\",\"Facile\"|\"4\",\"Difficile\"},\n)}$\n\n${#sante:=healthMalus}$\n\n${#combativite:=fightness}$\n\n${#type:=item.combatType}$\n\n<!-- définition des valeurs par défaut -->\n${#default:=6}$\n${#ccCombatCarrier:= (ccCombatCarrier ? ccCombatCarrier : default)}$\n${#ccCombatHobby:= (ccCombatHobby ? ccCombatHobby : default)}$\n${#contactCombatCarrier:= (contactCombatCarrier ? contactCombatCarrier : default)}$\n${#contactCombatHobby:= (contactCombatHobby ? contactCombatHobby : default)}$\n${#distanceCombatCarrier:= (distanceCombatCarrier ? distanceCombatCarrier : default)}$\n${#distanceCombatHobby:= (distanceCombatHobby ? distanceCombatHobby : default)}$\n\n<!-- définition du niveau du métier ou du hobby de référence -->\n${#level:=switchCase(type, \"1\", ${ccCombatCarrier >= ccCombatHobby ? ccCombatHobby : ccCombatCarrier}$, \"2\", ${contactCombatCarrier >= contactCombatHobby ? contactCombatHobby : contactCombatCarrier}$, \"3\", ${distanceCombatCarrier >= distanceCombatHobby ? distanceCombatHobby : distanceCombatCarrier}$, default)}$\n\n<!-- définition de la caractéristique de référence -->\n${#default:=0}$\n${#modificateur:=switchCase(type, \"1\", ${ccCombatCharacteristic?ccCombatCharacteristic:default}$, \"2\", ${contactCombatCharacteristic?contactCombatCharacteristic:default}$, \"3\", ${distanceCombatCharacteristic?distanceCombatCharacteristic:default}$, default)}$\n\n<!-- calcul du seuil de réussite -->\n${#seuil:= 10 - level - diff}$        \n\n<!-- calcul du bonus si le seuil est supérieur à 10 -->\n${#bonus:=((seuil + modificateur + combativite + sante) > 10 ? seuil + modificateur + combativite + sante- 10 : 0)}$\n\n<h3>Attaque avec <strong>${!item.name}$</strong> <span style=\"font-size: small;\">(${!(0 == diff ? \"Facile\" : (2 == diff ? \"Normal\":\"Difficile\"))}$)</span></h3>\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + bonus}$</strong> / ${seuil:=seuil + modificateur + combativite + sante}$\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; font-weight: bold; ${!roll<=seuil ? \"color: var(--color-level-success); border: solid 1px var(--color-level-success)\\\">Réussite\" : \"color: var(--color-level-error); border: solid 1px var(--color-level-error)\\\">Echec\"}$</p>\n      </td>\n    </tr>\n  </tbody>\n</table>\n","rhs":"<!-- Roll for attack -->\n${#concat(\n  ?{diff:\"Difficulté\"|\"2\",\"Normal\"|\"0\",\"Facile\"|\"4\",\"Difficile\"},\n  ?{modifManuel:\"Modificateur manuel\"[number]}\n)}$\n\n${#sante:=healthMalus}$\n${#combativite:=fightness}$\n${#type:=item.combatType}$\n\n<!-- définition des valeurs par défaut -->\n${#default:=6}$\n${#ccCombatCarrier:= (ccCombatCarrier ? ccCombatCarrier : default)}$\n${#ccCombatHobby:= (ccCombatHobby ? ccCombatHobby : default)}$\n${#contactCombatCarrier:= (contactCombatCarrier ? contactCombatCarrier : default)}$\n${#contactCombatHobby:= (contactCombatHobby ? contactCombatHobby : default)}$\n${#distanceCombatCarrier:= (distanceCombatCarrier ? distanceCombatCarrier : default)}$\n${#distanceCombatHobby:= (distanceCombatHobby ? distanceCombatHobby : default)}$\n\n<!-- définition du niveau du métier ou du hobby de référence -->\n${#level:=switchCase(type, \"1\", ${ccCombatCarrier >= ccCombatHobby ? ccCombatHobby : ccCombatCarrier}$, \"2\", ${contactCombatCarrier >= contactCombatHobby ? contactCombatHobby : contactCombatCarrier}$, \"3\", ${distanceCombatCarrier >= distanceCombatHobby ? distanceCombatHobby : distanceCombatCarrier}$, default)}$\n\n<!-- définition de la caractéristique de référence -->\n${#default:=0}$\n${#modificateur:=switchCase(type, \"1\", ${ccCombatCharacteristic?ccCombatCharacteristic:default}$, \"2\", ${contactCombatCharacteristic?contactCombatCharacteristic:default}$, \"3\", ${distanceCombatCharacteristic?distanceCombatCharacteristic:default}$, default)}$\n\n<!-- calcul du seuil de réussite -->\n${#seuil:= 10 - level - diff}$        \n\n<!-- calcul du bonus si le seuil est supérieur à 10 -->\n${#bonus:=((seuil + modificateur + combativite + sante + modifManuel) > 10 ? seuil + modificateur + combativite + sante + modifManuel - 10 : 0)}$\n\n<h3>Attaque avec <strong>${!item.name}$</strong> <span style=\"font-size: small;\">(${!(0 == diff ? \"Facile\" : (2 == diff ? \"Normal\":\"Difficile\"))}$)</span></h3>\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + bonus}$</strong> / ${seuil:=seuil + modificateur + combativite + sante + modifManuel}$\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; font-weight: bold; ${!roll<=seuil ? \"color: var(--color-level-success); border: solid 1px var(--color-level-success)\\\">Réussite\" : \"color: var(--color-level-error); border: solid 1px var(--color-level-error)\\\">Echec\"}$</p>\n      </td>\n    </tr>\n  </tbody>\n</table>\n"}],[{"kind":"A","path":["body","contents",0,"contents",1,"contents",1,"rowLayout"],"index":4,"item":{"kind":"D","lhs":{"key":"test","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"test","prefix":"","suffix":"","rollMessage":"${setPropertyInEntity('target', 'ref(stun)', 30)}$","altRollMessage":"","style":"label","type":"label","align":"left","colName":""}}}],[{"kind":"E","path":["body","contents",0,"contents",1,"contents",1,"rowLayout",2,"rollMessage"],"lhs":"<!-- Roll for attack -->\n${#concat(\n  ?{diff:\"Difficulté\"|\"2\",\"Normal\"|\"0\",\"Facile\"|\"4\",\"Difficile\"},\n  ?{modifManuel:\"Modificateur manuel\"[number]}\n)}$\n\n${#sante:=healthMalus}$\n${#combativite:=fightness}$\n${#type:=item.combatType}$\n\n<!-- définition des valeurs par défaut -->\n${#default:=6}$\n${#ccCombatCarrier:= (ccCombatCarrier ? ccCombatCarrier : default)}$\n${#ccCombatHobby:= (ccCombatHobby ? ccCombatHobby : default)}$\n${#contactCombatCarrier:= (contactCombatCarrier ? contactCombatCarrier : default)}$\n${#contactCombatHobby:= (contactCombatHobby ? contactCombatHobby : default)}$\n${#distanceCombatCarrier:= (distanceCombatCarrier ? distanceCombatCarrier : default)}$\n${#distanceCombatHobby:= (distanceCombatHobby ? distanceCombatHobby : default)}$\n\n<!-- définition du niveau du métier ou du hobby de référence -->\n${#level:=switchCase(type, \"1\", ${ccCombatCarrier >= ccCombatHobby ? ccCombatHobby : ccCombatCarrier}$, \"2\", ${contactCombatCarrier >= contactCombatHobby ? contactCombatHobby : contactCombatCarrier}$, \"3\", ${distanceCombatCarrier >= distanceCombatHobby ? distanceCombatHobby : distanceCombatCarrier}$, default)}$\n\n<!-- définition de la caractéristique de référence -->\n${#default:=0}$\n${#modificateur:=switchCase(type, \"1\", ${ccCombatCharacteristic?ccCombatCharacteristic:default}$, \"2\", ${contactCombatCharacteristic?contactCombatCharacteristic:default}$, \"3\", ${distanceCombatCharacteristic?distanceCombatCharacteristic:default}$, default)}$\n\n<!-- calcul du seuil de réussite -->\n${#seuil:= 10 - level - diff}$        \n\n<!-- calcul du bonus si le seuil est supérieur à 10 -->\n${#bonus:=((seuil + modificateur + combativite + sante + modifManuel) > 10 ? seuil + modificateur + combativite + sante + modifManuel - 10 : 0)}$\n\n<h3>Attaque avec <strong>${!item.name}$</strong> <span style=\"font-size: small;\">(${!(0 == diff ? \"Facile\" : (2 == diff ? \"Normal\":\"Difficile\"))}$)</span></h3>\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + bonus}$</strong> / ${seuil:=seuil + modificateur + combativite + sante + modifManuel}$\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; font-weight: bold; ${!roll<=seuil ? \"color: var(--color-level-success); border: solid 1px var(--color-level-success)\\\">Réussite\" : \"color: var(--color-level-error); border: solid 1px var(--color-level-error)\\\">Echec\"}$</p>\n      </td>\n    </tr>\n  </tbody>\n</table>\n","rhs":"<!-- Roll for attack -->\n${#concat(\n  ?{diff:\"Difficulté\"|\"2\",\"Normal\"|\"0\",\"Facile\"|\"4\",\"Difficile\"},\n  ?{modifManuel:\"Modificateur manuel\"[number]}\n)}$\n\n${#sante:=healthMalus}$\n${#combativite:=fightness}$\n${#type:=item.combatType}$\n\n<!-- définition des valeurs par défaut -->\n${#default:=6}$\n${#ccCombatCarrier:= (ccCombatCarrier ? ccCombatCarrier : default)}$\n${#ccCombatHobby:= (ccCombatHobby ? ccCombatHobby : default)}$\n${#contactCombatCarrier:= (contactCombatCarrier ? contactCombatCarrier : default)}$\n${#contactCombatHobby:= (contactCombatHobby ? contactCombatHobby : default)}$\n${#distanceCombatCarrier:= (distanceCombatCarrier ? distanceCombatCarrier : default)}$\n${#distanceCombatHobby:= (distanceCombatHobby ? distanceCombatHobby : default)}$\n\n<!-- définition du niveau du métier ou du hobby de référence -->\n${#level:=switchCase(type, \"1\", ${ccCombatCarrier >= ccCombatHobby ? ccCombatHobby : ccCombatCarrier}$, \"2\", ${contactCombatCarrier >= contactCombatHobby ? contactCombatHobby : contactCombatCarrier}$, \"3\", ${distanceCombatCarrier >= distanceCombatHobby ? distanceCombatHobby : distanceCombatCarrier}$, default)}$\n\n<!-- définition de la caractéristique de référence -->\n${#default:=0}$\n${#modificateur:=switchCase(type, \"1\", ${ccCombatCharacteristic?ccCombatCharacteristic:default}$, \"2\", ${contactCombatCharacteristic?contactCombatCharacteristic:default}$, \"3\", ${distanceCombatCharacteristic?distanceCombatCharacteristic:default}$, default)}$\n\n<!-- combativité de la cible -->\n${combativiteAdverse:=fetchFromActor('target', 'fightness')}$\n\n<!-- calcul du seuil de réussite -->\n${#seuil:= 10 - level - diff}$\n\n<!-- calcul du bonus si le seuil est supérieur à 10 -->\n${#bonus:=((seuil + modificateur + combativite + combativiteAdverse + sante + modifManuel) > 10 ? seuil + modificateur + combativite + combativiteAdverse + sante + modifManuel - 10 : 0)}$\n\n<h3>Attaque avec <strong>${!item.name}$</strong> <span style=\"font-size: small;\">(${!(0 == diff ? \"Facile\" : (2 == diff ? \"Normal\":\"Difficile\"))}$)</span></h3>\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + bonus}$</strong> / ${seuil:=seuil + modificateur + combativite + combativiteAdverse + sante + modifManuel}$\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; font-weight: bold; ${!roll<=seuil ? \"color: var(--color-level-success); border: solid 1px var(--color-level-success)\\\">Réussite\" : \"color: var(--color-level-error); border: solid 1px var(--color-level-error)\\\">Echec\"}$</p>\n      </td>\n    </tr>\n  </tbody>\n</table>\n"}],[{"kind":"E","path":["body","contents",0,"contents",1,"contents",1,"rowLayout",2,"rollMessage"],"lhs":"<!-- Roll for attack -->\n${#concat(\n  ?{diff:\"Difficulté\"|\"2\",\"Normal\"|\"0\",\"Facile\"|\"4\",\"Difficile\"},\n  ?{modifManuel:\"Modificateur manuel\"[number]}\n)}$\n\n${#sante:=healthMalus}$\n${#combativite:=fightness}$\n${#type:=item.combatType}$\n\n<!-- définition des valeurs par défaut -->\n${#default:=6}$\n${#ccCombatCarrier:= (ccCombatCarrier ? ccCombatCarrier : default)}$\n${#ccCombatHobby:= (ccCombatHobby ? ccCombatHobby : default)}$\n${#contactCombatCarrier:= (contactCombatCarrier ? contactCombatCarrier : default)}$\n${#contactCombatHobby:= (contactCombatHobby ? contactCombatHobby : default)}$\n${#distanceCombatCarrier:= (distanceCombatCarrier ? distanceCombatCarrier : default)}$\n${#distanceCombatHobby:= (distanceCombatHobby ? distanceCombatHobby : default)}$\n\n<!-- définition du niveau du métier ou du hobby de référence -->\n${#level:=switchCase(type, \"1\", ${ccCombatCarrier >= ccCombatHobby ? ccCombatHobby : ccCombatCarrier}$, \"2\", ${contactCombatCarrier >= contactCombatHobby ? contactCombatHobby : contactCombatCarrier}$, \"3\", ${distanceCombatCarrier >= distanceCombatHobby ? distanceCombatHobby : distanceCombatCarrier}$, default)}$\n\n<!-- définition de la caractéristique de référence -->\n${#default:=0}$\n${#modificateur:=switchCase(type, \"1\", ${ccCombatCharacteristic?ccCombatCharacteristic:default}$, \"2\", ${contactCombatCharacteristic?contactCombatCharacteristic:default}$, \"3\", ${distanceCombatCharacteristic?distanceCombatCharacteristic:default}$, default)}$\n\n<!-- combativité de la cible -->\n${combativiteAdverse:=fetchFromActor('target', 'fightness')}$\n\n<!-- calcul du seuil de réussite -->\n${#seuil:= 10 - level - diff}$\n\n<!-- calcul du bonus si le seuil est supérieur à 10 -->\n${#bonus:=((seuil + modificateur + combativite + combativiteAdverse + sante + modifManuel) > 10 ? seuil + modificateur + combativite + combativiteAdverse + sante + modifManuel - 10 : 0)}$\n\n<h3>Attaque avec <strong>${!item.name}$</strong> <span style=\"font-size: small;\">(${!(0 == diff ? \"Facile\" : (2 == diff ? \"Normal\":\"Difficile\"))}$)</span></h3>\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + bonus}$</strong> / ${seuil:=seuil + modificateur + combativite + combativiteAdverse + sante + modifManuel}$\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; font-weight: bold; ${!roll<=seuil ? \"color: var(--color-level-success); border: solid 1px var(--color-level-success)\\\">Réussite\" : \"color: var(--color-level-error); border: solid 1px var(--color-level-error)\\\">Echec\"}$</p>\n      </td>\n    </tr>\n  </tbody>\n</table>\n","rhs":"<!-- Roll for attack -->\n${#concat(\n  ?{diff:\"Difficulté\"|\"2\",\"Normal\"|\"0\",\"Facile\"|\"4\",\"Difficile\"},\n  ?{modifManuel:\"Modificateur manuel\"[number]}\n)}$\n\n${#sante:=healthMalus}$\n${#combativite:=fightness}$\n${#type:=item.combatType}$\n\n<!-- définition des valeurs par défaut -->\n${#default:=6}$\n${#ccCombatCarrier:= (ccCombatCarrier ? ccCombatCarrier : default)}$\n${#ccCombatHobby:= (ccCombatHobby ? ccCombatHobby : default)}$\n${#contactCombatCarrier:= (contactCombatCarrier ? contactCombatCarrier : default)}$\n${#contactCombatHobby:= (contactCombatHobby ? contactCombatHobby : default)}$\n${#distanceCombatCarrier:= (distanceCombatCarrier ? distanceCombatCarrier : default)}$\n${#distanceCombatHobby:= (distanceCombatHobby ? distanceCombatHobby : default)}$\n\n<!-- définition du niveau du métier ou du hobby de référence -->\n${#level:=switchCase(type, \"1\", ${ccCombatCarrier >= ccCombatHobby ? ccCombatHobby : ccCombatCarrier}$, \"2\", ${contactCombatCarrier >= contactCombatHobby ? contactCombatHobby : contactCombatCarrier}$, \"3\", ${distanceCombatCarrier >= distanceCombatHobby ? distanceCombatHobby : distanceCombatCarrier}$, default)}$\n\n<!-- définition de la caractéristique de référence -->\n${#default:=0}$\n${#modificateur:=switchCase(type, \"1\", ${ccCombatCharacteristic?ccCombatCharacteristic:default}$, \"2\", ${contactCombatCharacteristic?contactCombatCharacteristic:default}$, \"3\", ${distanceCombatCharacteristic?distanceCombatCharacteristic:default}$, default)}$\n\n<!-- combativité de la cible -->\n${combativiteAdverse:=(3 == type ? fetchFromActor('target', 'fightness') : 0)}$\n\n<!-- calcul du seuil de réussite -->\n${#seuil:= 10 - level - diff}$\n\n<!-- calcul du bonus si le seuil est supérieur à 10 -->\n${#bonus:=((seuil + modificateur + combativite + combativiteAdverse + sante + modifManuel) > 10 ? seuil + modificateur + combativite + combativiteAdverse + sante + modifManuel - 10 : 0)}$\n\n<h3>Attaque avec <strong>${!item.name}$</strong> <span style=\"font-size: small;\">(${!(0 == diff ? \"Facile\" : (2 == diff ? \"Normal\":\"Difficile\"))}$)</span></h3>\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + bonus}$</strong> / ${seuil:=seuil + modificateur + combativite + combativiteAdverse + sante + modifManuel}$\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; font-weight: bold; ${!roll<=seuil ? \"color: var(--color-level-success); border: solid 1px var(--color-level-success)\\\">Réussite\" : \"color: var(--color-level-error); border: solid 1px var(--color-level-error)\\\">Echec\"}$</p>\n      </td>\n    </tr>\n  </tbody>\n</table>\n"}],[{"kind":"E","path":["body","contents",0,"contents",1,"contents",1,"rowLayout",2,"rollMessage"],"lhs":"<!-- Roll for attack -->\n${#concat(\n  ?{diff:\"Difficulté\"|\"2\",\"Normal\"|\"0\",\"Facile\"|\"4\",\"Difficile\"},\n  ?{modifManuel:\"Modificateur manuel\"[number]}\n)}$\n\n${#sante:=healthMalus}$\n${#combativite:=fightness}$\n${#type:=item.combatType}$\n\n<!-- définition des valeurs par défaut -->\n${#default:=6}$\n${#ccCombatCarrier:= (ccCombatCarrier ? ccCombatCarrier : default)}$\n${#ccCombatHobby:= (ccCombatHobby ? ccCombatHobby : default)}$\n${#contactCombatCarrier:= (contactCombatCarrier ? contactCombatCarrier : default)}$\n${#contactCombatHobby:= (contactCombatHobby ? contactCombatHobby : default)}$\n${#distanceCombatCarrier:= (distanceCombatCarrier ? distanceCombatCarrier : default)}$\n${#distanceCombatHobby:= (distanceCombatHobby ? distanceCombatHobby : default)}$\n\n<!-- définition du niveau du métier ou du hobby de référence -->\n${#level:=switchCase(type, \"1\", ${ccCombatCarrier >= ccCombatHobby ? ccCombatHobby : ccCombatCarrier}$, \"2\", ${contactCombatCarrier >= contactCombatHobby ? contactCombatHobby : contactCombatCarrier}$, \"3\", ${distanceCombatCarrier >= distanceCombatHobby ? distanceCombatHobby : distanceCombatCarrier}$, default)}$\n\n<!-- définition de la caractéristique de référence -->\n${#default:=0}$\n${#modificateur:=switchCase(type, \"1\", ${ccCombatCharacteristic?ccCombatCharacteristic:default}$, \"2\", ${contactCombatCharacteristic?contactCombatCharacteristic:default}$, \"3\", ${distanceCombatCharacteristic?distanceCombatCharacteristic:default}$, default)}$\n\n<!-- combativité de la cible -->\n${combativiteAdverse:=(3 == type ? fetchFromActor('target', 'fightness') : 0)}$\n\n<!-- calcul du seuil de réussite -->\n${#seuil:= 10 - level - diff}$\n\n<!-- calcul du bonus si le seuil est supérieur à 10 -->\n${#bonus:=((seuil + modificateur + combativite + combativiteAdverse + sante + modifManuel) > 10 ? seuil + modificateur + combativite + combativiteAdverse + sante + modifManuel - 10 : 0)}$\n\n<h3>Attaque avec <strong>${!item.name}$</strong> <span style=\"font-size: small;\">(${!(0 == diff ? \"Facile\" : (2 == diff ? \"Normal\":\"Difficile\"))}$)</span></h3>\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + bonus}$</strong> / ${seuil:=seuil + modificateur + combativite + combativiteAdverse + sante + modifManuel}$\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; font-weight: bold; ${!roll<=seuil ? \"color: var(--color-level-success); border: solid 1px var(--color-level-success)\\\">Réussite\" : \"color: var(--color-level-error); border: solid 1px var(--color-level-error)\\\">Echec\"}$</p>\n      </td>\n    </tr>\n  </tbody>\n</table>\n","rhs":"<!-- Roll for attack -->\n${#concat(\n  ?{diff:\"Difficulté\"|\"2\",\"Normal\"|\"0\",\"Facile\"|\"4\",\"Difficile\"},\n)}$\n\n${#sante:=healthMalus}$\n${#combativite:=fightness}$\n${#type:=item.combatType}$\n\n<!-- définition des valeurs par défaut -->\n${#default:=6}$\n${#ccCombatCarrier:= (ccCombatCarrier ? ccCombatCarrier : default)}$\n${#ccCombatHobby:= (ccCombatHobby ? ccCombatHobby : default)}$\n${#contactCombatCarrier:= (contactCombatCarrier ? contactCombatCarrier : default)}$\n${#contactCombatHobby:= (contactCombatHobby ? contactCombatHobby : default)}$\n${#distanceCombatCarrier:= (distanceCombatCarrier ? distanceCombatCarrier : default)}$\n${#distanceCombatHobby:= (distanceCombatHobby ? distanceCombatHobby : default)}$\n\n<!-- définition du niveau du métier ou du hobby de référence -->\n${#level:=switchCase(type, \"1\", ${ccCombatCarrier >= ccCombatHobby ? ccCombatHobby : ccCombatCarrier}$, \"2\", ${contactCombatCarrier >= contactCombatHobby ? contactCombatHobby : contactCombatCarrier}$, \"3\", ${distanceCombatCarrier >= distanceCombatHobby ? distanceCombatHobby : distanceCombatCarrier}$, default)}$\n\n<!-- définition de la caractéristique de référence -->\n${#default:=0}$\n${#modificateur:=switchCase(type, \"1\", ${ccCombatCharacteristic?ccCombatCharacteristic:default}$, \"2\", ${contactCombatCharacteristic?contactCombatCharacteristic:default}$, \"3\", ${distanceCombatCharacteristic?distanceCombatCharacteristic:default}$, default)}$\n\n<!-- combativité de la cible -->\n${combativiteAdverse:=(3 == type ? fetchFromActor('target', 'fightness') : 0)}$\n\n<!-- calcul du seuil de réussite -->\n${#seuil:= 10 - level - diff}$\n\n<!-- calcul du bonus si le seuil est supérieur à 10 -->\n${#bonus:=((seuil + modificateur + combativite + combativiteAdverse + sante) > 10 ? seuil + modificateur + combativite + combativiteAdverse + sante - 10 : 0)}$\n\n<h3>Attaque avec <strong>${!item.name}$</strong> <span style=\"font-size: small;\">(${!(0 == diff ? \"Facile\" : (2 == diff ? \"Normal\":\"Difficile\"))}$)</span></h3>\n<table>\n  <tbody>\n    <tr>\n      <td><h4>Jet du dé</h4></td>\n      <td>\n        <strong>${roll:= [1d10] + bonus}$</strong> / ${seuil:=seuil + modificateur + combativite + combativiteAdverse + sante}$\n      </td>\n    </tr>\n    <tr>\n      <td colspan=\"2\">\n        <p style=\"padding: 2px; text-align: center; font-weight: bold; ${!roll<=seuil ? \"color: var(--color-level-success); border: solid 1px var(--color-level-success)\\\">Réussite\" : \"color: var(--color-level-error); border: solid 1px var(--color-level-error)\\\">Echec\"}$</p>\n      </td>\n    </tr>\n  </tbody>\n</table>\n"}]],"templateHistoryRedo":[]}}}],"items":[{"type":"_equippableItemTemplate","name":"_scales_arme","data":{"hidden":[],"header":{"contents":[{"key":"descriptionLabel","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Description","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"title","type":"label"},{"key":"description","cssClass":"","role":"0","permission":"0","tooltip":"Description de l'arme","visibilityFormula":"","label":"","defaultValue":"","size":null,"style":"dialog","type":"textArea"},{"key":"characteristicsLabel","cssClass":"","role":"0","permission":"0","tooltip":"Caractéristiques de l'arme","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Caractéristiques","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"title","type":"label"}],"key":"custom_header","cssClass":null,"role":0,"permission":0,"tooltip":null,"visibilityFormula":null,"flow":null,"align":null,"type":"panel"},"body":{"contents":[{"key":"characteristicsPanel","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","contents":[{"key":"typeLabel","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Type","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"bold","type":"label"},{"key":"combatType","cssClass":"","role":"0","permission":"0","tooltip":"Type de l'arme","visibilityFormula":"","label":"","defaultValue":"1","size":"full-size","options":[{"key":"1","value":"Corps-à-Corps"},{"key":"2","value":"Contact"},{"key":"3","value":"Distance"}],"tableKey":null,"tableKeyColumn":null,"tableLabelColumn":null,"formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"},{"key":"powerfullMaxLabel","cssClass":"","role":"0","permission":"0","tooltip":"","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Puissance maximale","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"bold","type":"label"},{"key":"powerfullMax","cssClass":"","role":"0","permission":"0","tooltip":"Puissance maximale de l'arme","visibilityFormula":"","label":"","defaultValue":"1","size":"full-size","options":[{"key":"1","value":"Faible"},{"key":"2","value":"Moyenne"},{"key":"3","value":"Importante"}],"tableKey":null,"tableKeyColumn":null,"tableLabelColumn":null,"formulaKeyOptions":null,"formulaLabelOptions":null,"type":"select"}],"flow":"grid-2","align":"left","type":"panel"}],"key":"custom_body","cssClass":null,"role":0,"permission":0,"tooltip":null,"visibilityFormula":null,"flow":null,"align":null,"type":"panel"},"display":{"width":"400","height":"500","fix_size":false,"pp_width":"64","pp_height":"64"},"templateSystemUniqueVersion":4254198799},"flags":{"custom-system-builder":{"version":"3.0.0","templateHistory":[[{"kind":"E","path":["body","contents",0,"contents",2,"style"],"lhs":"label","rhs":"bold"}],[{"kind":"E","path":["body","contents",0,"contents",0,"style"],"lhs":"bold","rhs":"button"}],[{"kind":"E","path":["body","contents",0,"contents",0,"style"],"lhs":"button","rhs":"bold"}],[{"kind":"A","path":["header","contents"],"index":2,"item":{"kind":"N","rhs":{"key":"characteristicsLabel","cssClass":"","role":"0","permission":"0","tooltip":"Caractéristiques de l'arme","visibilityFormula":"","label":null,"defaultValue":null,"size":"full-size","icon":"","value":"Caractéristiques","prefix":"","suffix":"","rollMessage":"","altRollMessage":"","style":"title","type":"label"}}}],[{"kind":"E","path":["body","contents",0,"key"],"lhs":"characteristicPanel","rhs":"characteristicsPanel"}],[{"kind":"E","path":["body","contents",0,"align"],"lhs":"right","rhs":"left"}],[{"kind":"E","path":["header","contents",1,"style"],"lhs":"sheet","rhs":"dialog"}],[{"kind":"E","path":["body","contents",0,"contents",2,"key"],"lhs":"typeLabel","rhs":"powerfullMax"},{"kind":"E","path":["body","contents",0,"contents",2,"tooltip"],"lhs":"","rhs":"Puissance maximale de l'arme"},{"kind":"E","path":["body","contents",0,"contents",2,"label"],"lhs":null,"rhs":""},{"kind":"E","path":["body","contents",0,"contents",2,"defaultValue"],"lhs":null,"rhs":"1"},{"kind":"D","path":["body","contents",0,"contents",2,"icon"],"lhs":""},{"kind":"D","path":["body","contents",0,"contents",2,"value"],"lhs":"Type"},{"kind":"D","path":["body","contents",0,"contents",2,"prefix"],"lhs":""},{"kind":"D","path":["body","contents",0,"contents",2,"suffix"],"lhs":""},{"kind":"D","path":["body","contents",0,"contents",2,"rollMessage"],"lhs":""},{"kind":"D","path":["body","contents",0,"contents",2,"altRollMessage"],"lhs":""},{"kind":"D","path":["body","contents",0,"contents",2,"style"],"lhs":"bold"},{"kind":"E","path":["body","contents",0,"contents",2,"type"],"lhs":"label","rhs":"select"},{"kind":"N","path":["body","contents",0,"contents",2,"options"],"rhs":[{"key":"1","value":"Faible"},{"key":"2","value":"Moyenne"},{"key":"3","value":"Importante"}]},{"kind":"N","path":["body","contents",0,"contents",2,"tableKey"],"rhs":null},{"kind":"N","path":["body","contents",0,"contents",2,"tableKeyColumn"],"rhs":null},{"kind":"N","path":["body","contents",0,"contents",2,"tableLabelColumn"],"rhs":null},{"kind":"N","path":["body","contents",0,"contents",2,"formulaKeyOptions"],"rhs":null},{"kind":"N","path":["body","contents",0,"contents",2,"formulaLabelOptions"],"rhs":null},{"kind":"E","path":["body","contents",0,"contents",1,"key"],"lhs":"powerfullMax","rhs":"powerfullMaxLabel"},{"kind":"E","path":["body","contents",0,"contents",1,"tooltip"],"lhs":"Puissance maximale de l'arme","rhs":""},{"kind":"E","path":["body","contents",0,"contents",1,"label"],"lhs":"","rhs":null},{"kind":"E","path":["body","contents",0,"contents",1,"defaultValue"],"lhs":"1","rhs":null},{"kind":"D","path":["body","contents",0,"contents",1,"options"],"lhs":[{"key":"1","value":"Faible"},{"key":"2","value":"Moyenne"},{"key":"3","value":"Importante"}]},{"kind":"D","path":["body","contents",0,"contents",1,"tableKey"],"lhs":null},{"kind":"D","path":["body","contents",0,"contents",1,"tableKeyColumn"],"lhs":null},{"kind":"D","path":["body","contents",0,"contents",1,"tableLabelColumn"],"lhs":null},{"kind":"D","path":["body","contents",0,"contents",1,"formulaKeyOptions"],"lhs":null},{"kind":"D","path":["body","contents",0,"contents",1,"formulaLabelOptions"],"lhs":null},{"kind":"E","path":["body","contents",0,"contents",1,"type"],"lhs":"select","rhs":"label"},{"kind":"N","path":["body","contents",0,"contents",1,"icon"],"rhs":""},{"kind":"N","path":["body","contents",0,"contents",1,"value"],"rhs":"Puissance maximale"},{"kind":"N","path":["body","contents",0,"contents",1,"prefix"],"rhs":""},{"kind":"N","path":["body","contents",0,"contents",1,"suffix"],"rhs":""},{"kind":"N","path":["body","contents",0,"contents",1,"rollMessage"],"rhs":""},{"kind":"N","path":["body","contents",0,"contents",1,"altRollMessage"],"rhs":""},{"kind":"N","path":["body","contents",0,"contents",1,"style"],"rhs":"bold"},{"kind":"E","path":["body","contents",0,"contents",0,"key"],"lhs":"powerfullMaxLabel","rhs":"typeLabel"},{"kind":"E","path":["body","contents",0,"contents",0,"value"],"lhs":"Puissance maximale","rhs":"Type"}],[{"kind":"E","path":["body","contents",0,"contents",3,"key"],"lhs":"type","rhs":"powerfullMax"},{"kind":"E","path":["body","contents",0,"contents",3,"tooltip"],"lhs":"Type de l'arme","rhs":"Puissance maximale de l'arme"},{"kind":"E","path":["body","contents",0,"contents",3,"options",2,"value"],"lhs":"Distance","rhs":"Importante"},{"kind":"E","path":["body","contents",0,"contents",3,"options",1,"value"],"lhs":"Contact","rhs":"Moyenne"},{"kind":"E","path":["body","contents",0,"contents",3,"options",0,"value"],"lhs":"Corps-à-Corps","rhs":"Faible"},{"kind":"E","path":["body","contents",0,"contents",2,"key"],"lhs":"powerfullMax","rhs":"powerfullMaxLabel"},{"kind":"E","path":["body","contents",0,"contents",2,"tooltip"],"lhs":"Puissance maximale de l'arme","rhs":""},{"kind":"E","path":["body","contents",0,"contents",2,"label"],"lhs":"","rhs":null},{"kind":"E","path":["body","contents",0,"contents",2,"defaultValue"],"lhs":"1","rhs":null},{"kind":"D","path":["body","contents",0,"contents",2,"options"],"lhs":[{"key":"1","value":"Faible"},{"key":"2","value":"Moyenne"},{"key":"3","value":"Importante"}]},{"kind":"D","path":["body","contents",0,"contents",2,"tableKey"],"lhs":null},{"kind":"D","path":["body","contents",0,"contents",2,"tableKeyColumn"],"lhs":null},{"kind":"D","path":["body","contents",0,"contents",2,"tableLabelColumn"],"lhs":null},{"kind":"D","path":["body","contents",0,"contents",2,"formulaKeyOptions"],"lhs":null},{"kind":"D","path":["body","contents",0,"contents",2,"formulaLabelOptions"],"lhs":null},{"kind":"E","path":["body","contents",0,"contents",2,"type"],"lhs":"select","rhs":"label"},{"kind":"N","path":["body","contents",0,"contents",2,"icon"],"rhs":""},{"kind":"N","path":["body","contents",0,"contents",2,"value"],"rhs":"Puissance maximale"},{"kind":"N","path":["body","contents",0,"contents",2,"prefix"],"rhs":""},{"kind":"N","path":["body","contents",0,"contents",2,"suffix"],"rhs":""},{"kind":"N","path":["body","contents",0,"contents",2,"rollMessage"],"rhs":""},{"kind":"N","path":["body","contents",0,"contents",2,"altRollMessage"],"rhs":""},{"kind":"N","path":["body","contents",0,"contents",2,"style"],"rhs":"bold"},{"kind":"E","path":["body","contents",0,"contents",1,"key"],"lhs":"powerfullMaxLabel","rhs":"type"},{"kind":"E","path":["body","contents",0,"contents",1,"tooltip"],"lhs":"","rhs":"Type de l'arme"},{"kind":"E","path":["body","contents",0,"contents",1,"label"],"lhs":null,"rhs":""},{"kind":"E","path":["body","contents",0,"contents",1,"defaultValue"],"lhs":null,"rhs":"1"},{"kind":"D","path":["body","contents",0,"contents",1,"icon"],"lhs":""},{"kind":"D","path":["body","contents",0,"contents",1,"value"],"lhs":"Puissance maximale"},{"kind":"D","path":["body","contents",0,"contents",1,"prefix"],"lhs":""},{"kind":"D","path":["body","contents",0,"contents",1,"suffix"],"lhs":""},{"kind":"D","path":["body","contents",0,"contents",1,"rollMessage"],"lhs":""},{"kind":"D","path":["body","contents",0,"contents",1,"altRollMessage"],"lhs":""},{"kind":"D","path":["body","contents",0,"contents",1,"style"],"lhs":"bold"},{"kind":"E","path":["body","contents",0,"contents",1,"type"],"lhs":"label","rhs":"select"},{"kind":"N","path":["body","contents",0,"contents",1,"options"],"rhs":[{"key":"1","value":"Corps-à-Corps"},{"key":"2","value":"Contact"},{"key":"3","value":"Distance"}]},{"kind":"N","path":["body","contents",0,"contents",1,"tableKey"],"rhs":null},{"kind":"N","path":["body","contents",0,"contents",1,"tableKeyColumn"],"rhs":null},{"kind":"N","path":["body","contents",0,"contents",1,"tableLabelColumn"],"rhs":null},{"kind":"N","path":["body","contents",0,"contents",1,"formulaKeyOptions"],"rhs":null},{"kind":"N","path":["body","contents",0,"contents",1,"formulaLabelOptions"],"rhs":null}],[{"kind":"E","path":["body","contents",0,"contents",1,"key"],"lhs":"type","rhs":"combatType"}]],"templateHistoryRedo":[]}}}]}